import{R as e,c as w,f as Ke,r as m,a as pe,E as ke,b as Ye,d as U,e as fe,u as le,g as Ee,h as I,i as he,j as De,k as H,l as Fe,m as Qe,n as re,o as Ze,p as ye,q as et,s as Q,t as tt,v as nt,w as st,x as ot,y as at,z as be,A as lt,B as rt,C as ct,D as it,F as ut,_ as G,G as mt,H as dt,N as pt,I as ft,O as Et,J as ht,K as oe,L as yt,M as gt,P as xt}from"./vendor.80eaf42d.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const r of l.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function s(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerpolicy&&(l.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?l.credentials="include":a.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(a){if(a.ep)return;a.ep=!0;const l=s(a);fetch(a.href,l)}})();function J(){return navigator.userAgent==="ClashX Runtime"}let F=null;class vt{constructor(n){this.instance=null,window.WebViewJavascriptBridge!=null&&(this.instance=window.WebViewJavascriptBridge),this.initBridge(s=>{this.instance=s,n()})}initBridge(n){if(!J())return n==null?void 0:n(null);if(window.WebViewJavascriptBridge!=null)return n(window.WebViewJavascriptBridge);if(window.WVJBCallbacks!=null)return window.WVJBCallbacks.push(n);window.WVJBCallbacks=[n];const s=document.createElement("iframe");s.style.display="none",s.src="https://__bridge_loaded__",document.documentElement.appendChild(s),setTimeout(()=>document.documentElement.removeChild(s),0)}async callHandler(n,s){return await new Promise(o=>{var a;(a=this.instance)==null||a.callHandler(n,s,o)})}async ping(){return await this.callHandler("ping")}async readConfigString(){return await this.callHandler("readConfigString")}async getPasteboard(){return await this.callHandler("getPasteboard")}async getAPIInfo(){return await this.callHandler("apiInfo")}async setPasteboard(n){return await this.callHandler("setPasteboard",n)}async writeConfigWithString(n){return await this.callHandler("writeConfigWithString",n)}async setSystemProxy(n){return await this.callHandler("setSystemProxy",n)}async getStartAtLogin(){return await this.callHandler("getStartAtLogin")}async getProxyDelay(n){return await this.callHandler("speedTest",n)}async setStartAtLogin(n){return await this.callHandler("setStartAtLogin",n)}async isSystemProxySet(){return await this.callHandler("isSystemProxySet")}}function wt(t){if(F!=null){t();return}F=new vt(t)}function O(t){const{title:n,children:s,className:o,style:a}=t;return e.createElement("header",{className:w("header",o),style:a},e.createElement("h1",{className:"md:text-xl"},n),e.createElement("div",{className:"flex flex-auto items-center justify-end"},s))}function T(t){const{type:n,size:s=14,className:o,style:a}=t,l=w("clash-iconfont",`icon-${n}`,o),r={fontSize:s,...a},c={...t,className:l,style:r};return e.createElement("i",{...c})}function B(){}function Ct(t,n){const s=[],o=[];for(const a of t)n(a)?s.push(a):o.push(a);return[s,o]}function L(t){var o;const n=["B","KiB","MiB","GiB","TiB"],s=Math.floor(Math.log(t||1)/Math.log(1024));return`${Ke(t/Math.pow(1024,s),2).toFixed(2)} ${(o=n==null?void 0:n[s])!=null?o:""}`}function Ae(t){return t.replace(/.*[/\\]/,"")}const V=m.exports.forwardRef((t,n)=>{const{className:s,style:o,children:a}=t;return e.createElement("div",{className:w("card",s),style:o,ref:n},a)});const Nt={SideBar:{Proxies:"Proxies",Overview:"Overview",Logs:"Logs",Rules:"Rules",Settings:"Setting",Connections:"Connections",Version:"Version",Inbounds:"Inbounds"},Settings:{title:"Settings",labels:{startAtLogin:"Start at login",language:"language",setAsSystemProxy:"Set as system proxy",allowConnectFromLan:"Allow connect from Lan",proxyMode:"Mode",socks5ProxyPort:"Socks5 proxy port",httpProxyPort:"HTTP proxy port",mixedProxyPort:"Mixed proxy port",externalController:"External controller"},values:{cn:"\u4E2D\u6587",en:"English",global:"Global",rules:"Rules",direct:"Direct",script:"Script"},versionString:"Current ClashX is the latest version\uFF1A{{version}}",checkUpdate:"Check Update",externalControllerSetting:{title:"External Controller",note:"Please note that modifying this configuration will only configure Dashboard. Will not modify your Clash configuration file. Please make sure that the external controller address matches the address in the Clash configuration file, otherwise, Dashboard will not be able to connect to Clash.",host:"Host",port:"Port",secret:"Secret"}},Logs:{title:"Logs",levelLabel:"Log level"},Rules:{title:"Rules",providerTitle:"Providers",providerUpdateTime:"Last updated at",ruleCount:"Rule count"},Connections:{title:"Connections",keepClosed:"Keep closed connections",total:{text:"total",upload:"upload",download:"download"},closeAll:{title:"Warning",content:"This would close all connections"},filter:{all:"All"},columns:{host:"Host",network:"Network",type:"Type",chains:"Chains",process:"Process",rule:"Rule",time:"Time",speed:"Speed",upload:"Upload",download:"Download",sourceIP:"Source IP"},info:{title:"Connection",id:"ID",host:"Host",hostEmpty:"Empty",dstIP:"IP",dstIPEmpty:"Empty",srcIP:"Source",upload:"Up",download:"Down",network:"Network",process:"Process",processPath:"Path",inbound:"Inbound",rule:"Rule",chains:"Chains",status:"Status",opening:"Open",closed:"Closed",closeConnection:"Close"}},Proxies:{title:"Proxies",editDialog:{title:"Edit Proxy",color:"Color",name:"Name",type:"Type",server:"Server",port:"Port",password:"Password",cipher:"Cipher",obfs:"Obfs","obfs-host":"Obfs-host",uuid:"UUID",alterId:"AlterId",tls:"TLS"},groupTitle:"Policy Group",providerTitle:"Providers",providerUpdateTime:"Last updated at",expandText:"Expand",collapseText:"Collapse",speedTestText:"Speed Test",breakConnectionsText:"Close connections which include the group"},Modal:{ok:"Ok",cancel:"Cancel"}},bt={SideBar:{Proxies:"\u4EE3\u7406",Overview:"\u603B\u89C8",Logs:"\u65E5\u5FD7",Rules:"\u89C4\u5219",Settings:"\u8BBE\u7F6E",Connections:"\u8FDE\u63A5",Version:"\u7248\u672C",Inbounds:"\u5165\u7AD9"},Settings:{title:"\u8BBE\u7F6E",labels:{startAtLogin:"\u5F00\u673A\u65F6\u542F\u52A8",language:"\u8BED\u8A00",setAsSystemProxy:"\u8BBE\u7F6E\u4E3A\u7CFB\u7EDF\u4EE3\u7406",allowConnectFromLan:"\u5141\u8BB8\u6765\u81EA\u5C40\u57DF\u7F51\u7684\u8FDE\u63A5",proxyMode:"\u4EE3\u7406\u6A21\u5F0F",socks5ProxyPort:"Socks5 \u4EE3\u7406\u7AEF\u53E3",httpProxyPort:"HTTP \u4EE3\u7406\u7AEF\u53E3",mixedProxyPort:"\u6DF7\u5408\u4EE3\u7406\u7AEF\u53E3",externalController:"\u5916\u90E8\u63A7\u5236\u8BBE\u7F6E"},values:{cn:"\u4E2D\u6587",en:"English",global:"\u5168\u5C40",rules:"\u89C4\u5219",direct:"\u76F4\u8FDE",script:"\u811A\u672C"},versionString:"\u5F53\u524D ClashX \u5DF2\u662F\u6700\u65B0\u7248\u672C\uFF1A{{version}}",checkUpdate:"\u68C0\u67E5\u66F4\u65B0",externalControllerSetting:{title:"\u7F16\u8F91\u5916\u90E8\u63A7\u5236\u8BBE\u7F6E",note:"\u8BF7\u6CE8\u610F\uFF0C\u4FEE\u6539\u8BE5\u914D\u7F6E\u9879\u5E76\u4E0D\u4F1A\u4FEE\u6539\u4F60\u7684 Clash \u914D\u7F6E\u6587\u4EF6\uFF0C\u8BF7\u786E\u8BA4\u4FEE\u6539\u540E\u7684\u5916\u90E8\u63A7\u5236\u5730\u5740\u548C Clash \u914D\u7F6E\u6587\u4EF6\u5185\u7684\u5730\u5740\u4E00\u81F4\uFF0C\u5426\u5219\u4F1A\u5BFC\u81F4 Dashboard \u65E0\u6CD5\u8FDE\u63A5\u3002",host:"Host",port:"\u7AEF\u53E3",secret:"\u5BC6\u94A5"}},Logs:{title:"\u65E5\u5FD7",levelLabel:"\u65E5\u5FD7\u7B49\u7EA7"},Rules:{title:"\u89C4\u5219",providerTitle:"\u89C4\u5219\u96C6",providerUpdateTime:"\u6700\u540E\u66F4\u65B0\u4E8E",ruleCount:"\u89C4\u5219\u6761\u6570"},Connections:{title:"\u8FDE\u63A5",keepClosed:"\u4FDD\u7559\u5173\u95ED\u8FDE\u63A5",total:{text:"\u603B\u91CF",upload:"\u4E0A\u4F20",download:"\u4E0B\u8F7D"},closeAll:{title:"\u8B66\u544A",content:"\u5C06\u4F1A\u5173\u95ED\u6240\u6709\u8FDE\u63A5"},filter:{all:"\u5168\u90E8"},columns:{host:"\u57DF\u540D",network:"\u7F51\u7EDC",process:"\u8FDB\u7A0B",type:"\u7C7B\u578B",chains:"\u8282\u70B9\u94FE",rule:"\u89C4\u5219",time:"\u8FDE\u63A5\u65F6\u95F4",speed:"\u901F\u7387",upload:"\u4E0A\u4F20",download:"\u4E0B\u8F7D",sourceIP:"\u6765\u6E90 IP"},info:{title:"\u8FDE\u63A5\u4FE1\u606F",id:"ID",host:"\u57DF\u540D",hostEmpty:"\u7A7A",dstIP:"IP",dstIPEmpty:"\u7A7A",srcIP:"\u6765\u6E90",upload:"\u4E0A\u4F20",download:"\u4E0B\u8F7D",network:"\u7F51\u7EDC",process:"\u8FDB\u7A0B",processPath:"\u8DEF\u5F84",inbound:"\u5165\u53E3",rule:"\u89C4\u5219",chains:"\u4EE3\u7406",status:"\u72B6\u6001",opening:"\u8FDE\u63A5\u4E2D",closed:"\u5DF2\u5173\u95ED",closeConnection:"\u5173\u95ED\u8FDE\u63A5"}},Proxies:{title:"\u4EE3\u7406",editDialog:{title:"\u7F16\u8F91\u4EE3\u7406",color:"\u989C\u8272",name:"\u540D\u5B57",type:"\u7C7B\u578B",server:"\u670D\u52A1\u5668",port:"\u7AEF\u53E3",password:"\u5BC6\u7801",cipher:"\u52A0\u5BC6\u65B9\u5F0F",obfs:"Obfs","obfs-host":"Obfs-host",uuid:"UUID",alterId:"AlterId",tls:"TLS"},groupTitle:"\u7B56\u7565\u7EC4",providerTitle:"\u4EE3\u7406\u96C6",providerUpdateTime:"\u6700\u540E\u66F4\u65B0\u4E8E",expandText:"\u5C55\u5F00",collapseText:"\u6536\u8D77",speedTestText:"\u6D4B\u901F",breakConnectionsText:"\u5207\u6362\u65F6\u6253\u65AD\u5305\u542B\u7B56\u7565\u7EC4\u7684\u8FDE\u63A5"},Modal:{ok:"\u786E \u5B9A",cancel:"\u53D6 \u6D88"}},$e={en_US:Nt,zh_CN:bt},Pt=Object.keys($e);function St(){for(const t of window.navigator.languages){if(t.includes("zh"))return"zh_CN";if(t.includes("us"))return"en_US"}return"en_US"}function ee(t){return m.exports.useMemo(()=>{function s(o,a){if(typeof o=="string")t(l=>{const r=o,c=a;l[r]=c});else if(typeof o=="function"){const l=o;t(r=>l(r))}else typeof o=="object"&&t(l=>pe(l,r=>{const c=o;for(const i of Object.keys(c)){const d=i;r[d]=c[d]}}))}return s},[t])}class Ie{constructor(n){this.EE=new ke,this.innerBuffer=[],this.url="",this.connection=null,this.config=Object.assign({bufferLength:0,retryInterval:5e3},n)}connectWebsocket(){if(!this.url)return;const n=new URL(this.url);this.connection=new WebSocket(n.toString()),this.connection.addEventListener("message",s=>{const o=JSON.parse(s.data);this.EE.emit("data",[o]),this.config.bufferLength>0&&(this.innerBuffer.push(o),this.innerBuffer.length>this.config.bufferLength&&this.innerBuffer.splice(0,this.innerBuffer.length-this.config.bufferLength))}),this.connection.addEventListener("error",s=>{var o;this.EE.emit("error",s),(o=this.connection)==null||o.close(),setTimeout(this.connectWebsocket,this.config.retryInterval)})}connect(n){var s;this.url===n&&this.connection||(this.url=n,(s=this.connection)==null||s.close(),this.connectWebsocket())}subscribe(n,s){this.EE.addListener(n,s)}unsubscribe(n,s){this.EE.removeListener(n,s)}buffer(){return this.innerBuffer.slice()}destory(){var n;this.EE.removeAllListeners(),(n=this.connection)==null||n.close(),this.connection=null}}class kt{constructor(n,s){this.axiosClient=Ye.create({baseURL:n,headers:s?{Authorization:`Bearer ${s}`}:{}})}async getConfig(){return await this.axiosClient.get("configs")}async updateConfig(n){return await this.axiosClient.patch("configs",n)}async getRules(){return await this.axiosClient.get("rules")}async getProxyProviders(){const n=await this.axiosClient.get("providers/proxies",{validateStatus(s){return s>=200&&s<300||s===404}});return n.status===404&&(n.data={providers:{}}),n}async getRuleProviders(){return await this.axiosClient.get("providers/rules")}async updateProvider(n){return await this.axiosClient.put(`providers/proxies/${encodeURIComponent(n)}`)}async updateRuleProvider(n){return await this.axiosClient.put(`providers/rules/${encodeURIComponent(n)}`)}async healthCheckProvider(n){return await this.axiosClient.get(`providers/proxies/${encodeURIComponent(n)}/healthcheck`)}async getProxies(){return await this.axiosClient.get("proxies")}async getProxy(n){return await this.axiosClient.get(`proxies/${encodeURIComponent(n)}`)}async getVersion(){return await this.axiosClient.get("version")}async getProxyDelay(n){return await this.axiosClient.get(`proxies/${encodeURIComponent(n)}/delay`,{params:{timeout:5e3,url:"http://www.gstatic.com/generate_204"}})}async closeAllConnections(){return await this.axiosClient.delete("connections")}async closeConnection(n){return await this.axiosClient.delete(`connections/${n}`)}async getConnections(){return await this.axiosClient.get("connections")}async changeProxySelected(n,s){return await this.axiosClient.put(`proxies/${encodeURIComponent(n)}`,{name:s})}async getInbounds(){return await this.axiosClient.get("inbounds")}}const Dt=U(async()=>{if(!J())return null;const t=await F.getAPIInfo();return{hostname:t.host,port:t.port,secret:t.secret,protocol:"http:"}}),Re=fe("externalControllers",[]);function te(){var d,f,E,x,h,p,y,C,N,b,S,D,Y,j,X;const t=le(Dt),n=Ee(),s=le(Re);if(t!=null)return t;let o;{const W=document.querySelector('meta[name="external-controller"]');((d=W==null?void 0:W.content)==null?void 0:d.match(/^https?:/))!=null&&(o=new URL(W.content))}const a=new URLSearchParams(n.search),l=(h=(x=(f=o==null?void 0:o.hostname)!=null?f:a.get("host"))!=null?x:(E=s==null?void 0:s[0])==null?void 0:E.hostname)!=null?h:"127.0.0.1",r=(N=(C=(p=o==null?void 0:o.port)!=null?p:a.get("port"))!=null?C:(y=s==null?void 0:s[0])==null?void 0:y.port)!=null?N:"9090",c=(Y=(D=(b=o==null?void 0:o.username)!=null?b:a.get("secret"))!=null?D:(S=s==null?void 0:s[0])==null?void 0:S.secret)!=null?Y:"",i=((j=a.get("protocol"))!=null?j:l==="127.0.0.1")?"http:":(X=o==null?void 0:o.protocol)!=null?X:window.location.protocol;return{hostname:l,port:r,secret:c,protocol:i}}const Ft=U({key:"",instance:null});function A(){const{hostname:t,port:n,secret:s,protocol:o}=te(),[a,l]=I(Ft),r=`${o}//${t}:${n}?secret=${s}`;if(a.key===r)return a.instance;const c=new kt(`${o}//${t}:${n}`,s);return l({key:r,instance:c}),c}const Le=U(!0),At=fe("language",void 0);function k(){const[t,n]=I(At),s=m.exports.useMemo(()=>t!=null?t:St(),[t]),o=m.exports.useCallback(function(a){function l(r){return Ze($e[s][a],r)}return{t:l}},[s]);return{lang:s,locales:Pt,setLang:n,translation:o}}const Te=U({version:"",premium:!1});function $t(){const[t,n]=I(Te),s=A(),o=De(Le);return H([s],async function(){const a=await Fe.fromPromise(s.getVersion(),l=>l);o(a.isOk()),n(a.isErr()?{version:"",premium:!1}:{version:a.value.data.version,premium:!!a.value.data.premium})}),t}function Be(){const[{premium:t}]=I(Te),n=A(),{data:s,mutate:o}=H(["/providers/rule",n,t],async()=>{if(!t)return[];const a=await n.getRuleProviders();return Object.keys(a.data.providers).map(l=>a.data.providers[l])});return{providers:s!=null?s:[],update:o}}const It=fe("profile",{breakConnections:!1,logLevel:""});function ne(){const[t,n]=I(It),s=m.exports.useCallback(o=>{n(pe(t,o))},[t,n]);return{data:t,set:ee(s)}}const Me=U([]);function ze(){const[t,n]=I(Me),s=A(),{data:o,mutate:a}=H(["/providers/proxy",s],async()=>{const l=await s.getProxyProviders();return Object.keys(l.data.providers).map(r=>l.data.providers[r]).filter(r=>r.name!=="default").filter(r=>r.vehicleType!=="Compatible")});return m.exports.useEffect(()=>{n(o!=null?o:[])},[o,n]),{providers:t,update:a}}function ge(){const t=A(),{data:n,mutate:s}=H(["/config",t],async()=>{var l;const a=(await t.getConfig()).data;return{port:a.port,socksPort:a["socks-port"],mixedPort:(l=a["mixed-port"])!=null?l:0,redirPort:a["redir-port"],mode:a.mode.toLowerCase(),logLevel:a["log-level"],allowLan:a["allow-lan"]}});return{general:n!=null?n:{},update:s}}const He=he({proxies:[],groups:[],global:{name:"GLOBAL",type:"Selector",now:"",history:[],all:[]}});function se(){const[t,n]=I(He),s=ee(n),o=A(),{mutate:a}=H(["/proxies",o],async()=>{const r=await o.getProxies(),c=r.data.proxies.GLOBAL;c.name="GLOBAL";const i=new Set(["Selector","URLTest","Fallback","LoadBalance","AutoSelector"]),d=new Set(["DIRECT","REJECT","GLOBAL"]),f=c.all.filter(h=>!d.has(h)).map(h=>({...r.data.proxies[h],name:h})),[E,x]=Ct(f,h=>!i.has(h.type));s({proxies:E,groups:x,global:c})}),l=m.exports.useCallback((r,c)=>{s(i=>{r==="GLOBAL"&&(i.global.now=c);for(const d of i.groups)d.name===r&&(d.now=c)})},[s]);return{proxies:t.proxies,groups:t.groups,global:t.global,update:a,markProxySelected:l,set:s}}const Rt=U(t=>{const n=t(He),s=t(Me),o=new Map;for(const a of n.proxies)o.set(a.name,a);for(const a of s)for(const l of a.proxies)o.set(l.name,l);return o});function Lt(){const{data:t,mutate:n}=H("/clashx",async()=>{var a,l;if(!J())return{isClashX:!1,startAtLogin:!1,systemProxy:!1};const s=(a=await(F==null?void 0:F.getStartAtLogin()))!=null?a:!1,o=(l=await(F==null?void 0:F.isSystemProxySet()))!=null?l:!1;return{startAtLogin:s,systemProxy:o,isClashX:!0}});return{data:t,update:n}}const Tt=he([]);function Bt(){const[t,n]=I(Tt),s=ee(n),o=A();async function a(){const l=await o.getRules();s(l.data.rules)}return{rules:t,update:a}}const Mt=U(new Ie({bufferLength:200}));function Ue(){const t=te(),{general:n}=ge(),{data:{logLevel:s}}=ne(),o=le(Mt),a=s||n.logLevel,l=Qe(`${t.protocol}//${t.hostname}:${t.port}/logs?level=${a}&secret=${encodeURIComponent(t.secret)}`),r=re(t);return m.exports.useEffect(()=>{if(a){const c=r.current,d=`${c.protocol==="http:"?"ws:":"wss:"}//${c.hostname}:${c.port}/logs?level=${a}&token=${encodeURIComponent(c.secret)}`;o.connect(d)}},[r,o,a,l]),o}function zt(){const t=te(),n=m.exports.useRef(new Ie({bufferLength:200})),o=`${t.protocol==="http:"?"ws:":"wss:"}//${t.hostname}:${t.port}/connections?token=${encodeURIComponent(t.secret)}`;return m.exports.useEffect(()=>{n.current.connect(o)},[o]),n.current}const Ht=he([]);function Ut(){const[t,n]=I(Ht),s=ee(n),o=A();async function a(){const l=await o.getInbounds();s(l.data)}return{inbounds:t,update:a}}function Ot(t){const{className:n,data:s,onClick:o,select:a,canClick:l,errSet:r,rowHeight:c}=t,{translation:i}=k(),{t:d}=i("Proxies"),[f,E]=m.exports.useState(!1),[x,h]=m.exports.useState(!1),p=m.exports.useRef(null);m.exports.useLayoutEffect(()=>{var S,D;h(((D=(S=p==null?void 0:p.current)==null?void 0:S.offsetHeight)!=null?D:0)>30)},[]);const y=f?"auto":c,C=l?o:B;function N(){E(!f)}const b=s.map(S=>{const D=w({"tags-selected":a===S,"cursor-pointer":l,error:r==null?void 0:r.has(S)});return e.createElement("li",{className:D,key:S,onClick:()=>C(S)},S)});return e.createElement("div",{className:w("flex items-start overflow-y-hidden",n),style:{height:y}},e.createElement("ul",{ref:p,className:w("tags",{expand:f})},b),x&&e.createElement("span",{className:"h-7 cursor-pointer select-none px-5 leading-7",onClick:N},d(f?"collapseText":"expandText")))}function ae(t){const{className:n,style:s,value:o="",align:a="center",inside:l=!1,autoFocus:r=!1,type:c="text",disabled:i=!1,onChange:d=B,onBlur:f=B,onEnter:E=B}=t,x=w("input",`text-${a}`,{"focus:shadow-none":l},n);function h(p){p.code==="Enter"&&E(p)}return e.createElement("input",{disabled:i,className:x,style:s,value:o,autoFocus:r,type:c,onChange:p=>d(p.target.value,p),onBlur:f,onKeyDown:h})}function Vt(t){const{value:n,options:s,onSelect:o,disabled:a,className:l,style:r}=t,c=m.exports.useRef(document.createElement("div")),i=m.exports.useRef(null),[d,f]=m.exports.useState(!1),[E,x]=m.exports.useState({});m.exports.useLayoutEffect(()=>{const C=i.current.getBoundingClientRect();x({top:Math.floor(C.top+C.height)+6,left:Math.floor(C.left)-10})},[]),m.exports.useLayoutEffect(()=>{const C=c.current;return document.body.appendChild(C),()=>{document.body.removeChild(C)}},[]);function h(){a||f(!d)}const p=m.exports.useMemo(()=>s.find(C=>C.value===n),[n,s]),y=e.createElement("div",{className:w("select-list",{"select-list-show":d}),style:E},e.createElement("ul",{className:"list"},s.map(C=>{var N;return e.createElement(jt,{className:w({selected:C.value===n}),onClick:b=>{o==null||o(C.value,b),f(!1)},disabled:C.disabled,key:(N=C.key)!=null?N:C.value,value:C.value},C.label)})));return e.createElement(e.Fragment,null,e.createElement("div",{className:w("select",{disabled:a},l),style:r,ref:i,onClick:h},p==null?void 0:p.label,e.createElement(T,{type:"triangle-down"})),ye.exports.createPortal(y,c.current))}function jt(t){const{className:n,style:s,disabled:o=!1,children:a,onClick:l=B}=t,r=w("option",{disabled:o},n);return e.createElement("li",{className:r,style:s,onClick:l},a)}function Oe(t){const{show:n=!0,title:s="Modal",size:o="small",footer:a=!0,onOk:l=B,onClose:r=B,bodyClassName:c,bodyStyle:i,className:d,style:f,children:E}=t,{translation:x}=k(),{t:h}=x("Modal"),p=m.exports.useRef(document.createElement("div")),y=m.exports.useRef(null);m.exports.useLayoutEffect(()=>{const b=p.current;return document.body.appendChild(b),()=>{document.body.removeChild(b)}},[]);function C(b){b.target===y.current&&r()}const N=e.createElement("div",{className:w("modal-mask",{"modal-show":n}),ref:y,onMouseDown:C},e.createElement("div",{className:w("modal",`modal-${o}`,d),style:f},e.createElement("div",{className:"modal-title"},s),e.createElement("div",{className:w("modal-body",c),style:i},E),a&&e.createElement("div",{className:"footer"},e.createElement(ce,{onClick:()=>r()},h("cancel")),e.createElement(ce,{type:"primary",onClick:()=>l()},h("ok")))));return ye.exports.createPortal(N,p.current)}const Wt={success:"check",info:"info",warning:"info",error:"close"};function _t(t){const{message:n="",type:s="info",inside:o=!1,children:a,className:l,style:r}=t,c=w("alert",`alert-${o?"note":"box"}-${s}`,l);return e.createElement("div",{className:c,style:r},e.createElement("span",{className:"alert-icon"},e.createElement(T,{type:Wt[s],size:26})),n?e.createElement("p",{className:"alert-message"},n):e.createElement("div",{className:"alert-message"},a))}function ce(t){const{type:n="normal",onClick:s=B,children:o,className:a,style:l,disiabled:r}=t,c=w("button",`button-${n}`,a,{"button-disabled":r});return e.createElement("button",{className:c,style:l,onClick:s,disabled:r},o)}function ie(t){const[n,s]=et(t),o=m.exports.useMemo(()=>{function a(l,r){typeof l=="string"?s(c=>{const i=l,d=r;c[i]=d}):typeof l=="function"?s(l):typeof l=="object"&&s(c=>{const i=l;for(const d of Object.keys(i)){const f=d;c[f]=i[f]}})}return a},[s]);return[n,o]}function Gt(t,n=0){if(t.length<2)throw new Error("List requires at least two elements");const[s,o]=m.exports.useState(n);function a(){o((s+1)%t.length)}return{current:m.exports.useMemo(()=>t[s],[t,s]),next:a}}function xe(t=!1){const[n,s]=m.exports.useState(t);function o(){s(!1)}function a(){s(!0)}return{visible:n,hide:o,show:a}}function Ve(t){const{className:n,checked:s=!1,onChange:o=B}=t,a=w("checkbox",{checked:s},n);function l(){o(!s)}return e.createElement("div",{className:a,onClick:l},e.createElement(T,{className:"checkbox-icon",type:"check",size:18}),e.createElement("div",null,t.children))}function Z(t){const{color:n,className:s,style:o}=t,a=w("tag",s),l={color:n,...o},r={...t,className:a,style:l};return e.createElement("span",{...r},t.children)}function Jt(t){const n=w("spinner",t.className);return e.createElement("div",{className:n},e.createElement("div",{className:"spinner-circle"},e.createElement("div",{className:"spinner-inner"})),e.createElement("div",{className:"spinner-circle"},e.createElement("div",{className:"spinner-inner"})),e.createElement("div",{className:"spinner-circle"},e.createElement("div",{className:"spinner-inner"})),e.createElement("div",{className:"spinner-circle"},e.createElement("div",{className:"spinner-inner"})),e.createElement("div",{className:"spinner-circle"},e.createElement("div",{className:"spinner-inner"})))}function je(t){const n=w("loading","visible",t.className);return t.visible?e.createElement("div",{className:n},e.createElement(Jt,{className:t.spinnerClassName})):null}function Xt(t){var a,l,r;const n=m.exports.useRef(document.createElement("div"));m.exports.useLayoutEffect(()=>{const c=n.current;return document.body.appendChild(c),()=>{document.body.removeChild(c)}},[]);const s="absolute h-full right-0 transition-transform transform translate-x-full duration-100 pointer-events-auto",o=e.createElement("div",{className:w(t.className,"z-9999 pointer-events-none absolute inset-0")},e.createElement(V,{className:w(s,t.bodyClassName,{"translate-x-0":t.visible}),style:{width:(a=t.width)!=null?a:400}},t.children));return ye.exports.createPortal(o,(r=(l=t.containerRef)==null?void 0:l.current)!=null?r:n.current)}Q.extend(tt);function ve(t,n){const s=n==="en_US"?"en":"zh-cn";return Q(t).locale(s).from(Q())}function qt(t){const{translation:n}=k(),s=m.exports.useMemo(()=>n("Connections").t,[n]),{className:o,style:a}=t,l=w("flex flex-wrap px-1",o);function r(c){var i;(i=t.onChange)==null||i.call(t,c)}return e.createElement("div",{className:l,style:a},e.createElement("div",{className:w("connections-devices-item mb-2 pt-2",{selected:t.selected===""}),onClick:()=>r("")},s("filter.all")),t.devices.map(c=>e.createElement("div",{key:c.label,className:w("connections-devices-item mb-2 pt-2",{selected:t.selected===c.label}),onClick:()=>r(c.label)},c.label," (",c.number,")")))}function Kt(t){var o,a,l,r,c,i,d,f,E,x,h,p,y;const{translation:n}=k(),s=m.exports.useMemo(()=>n("Connections").t,[n]);return e.createElement("div",{className:w(t.className,"flex flex-col overflow-y-auto text-sm")},e.createElement("div",{className:"my-3 flex"},e.createElement("span",{className:"w-20 font-bold"},s("info.id")),e.createElement("span",{className:"font-mono"},t.connection.id)),e.createElement("div",{className:"my-3 flex justify-between"},e.createElement("div",{className:"flex flex-1"},e.createElement("span",{className:"w-20 font-bold"},s("info.network")),e.createElement("span",{className:"font-mono"},(o=t.connection.metadata)==null?void 0:o.network)),e.createElement("div",{className:"flex flex-1"},e.createElement("span",{className:"w-20 font-bold"},s("info.inbound")),e.createElement("span",{className:"font-mono"},(a=t.connection.metadata)==null?void 0:a.type))),e.createElement("div",{className:"my-3 flex"},e.createElement("span",{className:"w-20 font-bold"},s("info.host")),e.createElement("span",{className:"flex-1 break-all font-mono"},(l=t.connection.metadata)!=null&&l.host?`${t.connection.metadata.host}:${(r=t.connection.metadata)==null?void 0:r.destinationPort}`:s("info.hostEmpty"))),e.createElement("div",{className:"my-3 flex"},e.createElement("span",{className:"w-20 font-bold"},s("info.dstIP")),e.createElement("span",{className:"font-mono"},(c=t.connection.metadata)!=null&&c.destinationIP?`${t.connection.metadata.destinationIP}:${(i=t.connection.metadata)==null?void 0:i.destinationPort}`:s("info.hostEmpty"))),e.createElement("div",{className:"my-3 flex"},e.createElement("span",{className:"w-20 font-bold"},s("info.srcIP")),e.createElement("span",{className:"font-mono"},`${(d=t.connection.metadata)==null?void 0:d.sourceIP}:${(f=t.connection.metadata)==null?void 0:f.sourcePort}`)),e.createElement("div",{className:"my-3 flex"},e.createElement("span",{className:"w-20 font-bold"},s("info.process")),e.createElement("span",{className:"flex-1 break-all font-mono"},(E=t.connection.metadata)!=null&&E.processPath?`${Ae(t.connection.metadata.processPath)}`:s("info.hostEmpty"))),e.createElement("div",{className:"my-3 flex"},e.createElement("span",{className:"w-20 font-bold"},s("info.processPath")),e.createElement("span",{className:"flex-1 break-all font-mono"},(x=t.connection.metadata)!=null&&x.processPath?`${t.connection.metadata.processPath}`:s("info.hostEmpty"))),e.createElement("div",{className:"my-3 flex"},e.createElement("span",{className:"w-20 font-bold"},s("info.rule")),e.createElement("span",{className:"font-mono"},t.connection.rule&&`${t.connection.rule}${t.connection.rulePayload&&` :: ${t.connection.rulePayload}`}`)),e.createElement("div",{className:"my-3 flex"},e.createElement("span",{className:"w-20 font-bold"},s("info.chains")),e.createElement("span",{className:"flex-1 break-all font-mono"},(h=t.connection.chains)==null?void 0:h.slice().reverse().join(" / "))),e.createElement("div",{className:"my-3 flex justify-between"},e.createElement("div",{className:"flex flex-1"},e.createElement("span",{className:"w-20 font-bold"},s("info.upload")),e.createElement("span",{className:"font-mono"},L((p=t.connection.upload)!=null?p:0))),e.createElement("div",{className:"flex flex-1"},e.createElement("span",{className:"w-20 font-bold"},s("info.download")),e.createElement("span",{className:"font-mono"},L((y=t.connection.download)!=null?y:0)))),e.createElement("div",{className:"my-3 flex"},e.createElement("span",{className:"w-20 font-bold"},s("info.status")),e.createElement("span",{className:"font-mono"},t.connection.completed?e.createElement("span",{className:"text-red"},s("info.closed")):e.createElement("span",{className:"text-green"},s("info.opening")))))}class Yt{constructor(){this.connections=new Map,this.saveDisconnection=!1}appendToSet(n){var o;const s=n.reduce((a,l)=>a.set(l.id,l),new Map);for(const a of this.connections.keys())if(!s.has(a))if(!this.saveDisconnection)this.connections.delete(a);else{const l=this.connections.get(a);l!=null&&this.connections.set(a,pe(l,r=>{r.completed=!0,r.uploadSpeed=0,r.downloadSpeed=0}))}for(const a of s.keys()){if(!this.connections.has(a)){this.connections.set(a,{...s.get(a),uploadSpeed:0,downloadSpeed:0});continue}const l=this.connections.get(a),r=s.get(a);(o=this.connections)==null||o.set(a,{...r,uploadSpeed:r.upload-l.upload,downloadSpeed:r.download-l.download})}}toggleSave(){var n,s;if(this.saveDisconnection){this.saveDisconnection=!1;for(const o of this.connections.keys())(s=(n=this.connections)==null?void 0:n.get(o))!=null&&s.completed&&this.connections.delete(o)}else this.saveDisconnection=!0;return this.saveDisconnection}getConnections(){return[...this.connections.values()]}}function Qt(){const t=m.exports.useMemo(()=>new Yt,[]),n=m.exports.useRef(!0),[s,o]=m.exports.useState([]),[a,l]=m.exports.useState(!1),r=m.exports.useCallback(function(i){t.appendToSet(i),n.current&&o(t.getConnections()),n.current=!n.current},[t]),c=m.exports.useCallback(function(){const i=t.toggleSave();l(i),i||o(t.getConnections()),n.current=!0},[t]);return{connections:s,feed:r,toggleSave:c,save:a}}const v={Host:"host",Network:"network",Process:"process",Type:"type",Chains:"chains",Rule:"rule",Speed:"speed",Upload:"upload",Download:"download",SourceIP:"sourceIP",Time:"time"},Zt=new Set([v.Network,v.Type,v.Speed,v.Upload,v.Download,v.SourceIP,v.Time,v.Process]);function en(t,n){switch(!0){case(t===0&&n===0):return"-";case(t!==0&&n!==0):return`\u2191 ${L(t)}/s \u2193 ${L(n)}/s`;case t!==0:return`\u2191 ${L(t)}/s`;default:return`\u2193 ${L(n)}/s`}}const $=lt();function tn(){const{translation:t,lang:n}=k(),s=m.exports.useMemo(()=>t("Connections").t,[t]),o=zt(),a=re(o),l=A(),r=m.exports.useRef(null),[c,i]=ie({uploadTotal:0,downloadTotal:0}),{visible:d,show:f,hide:E}=xe();function x(){l.closeAllConnections().finally(()=>E())}const{connections:h,feed:p,save:y,toggleSave:C}=Qt(),N=m.exports.useMemo(()=>h.map(u=>({id:u.id,host:`${u.metadata.host||u.metadata.destinationIP}:${u.metadata.destinationPort}`,chains:u.chains.slice().reverse().join(" / "),rule:u.rulePayload?`${u.rule} :: ${u.rulePayload}`:u.rule,time:new Date(u.start).getTime(),upload:u.upload,download:u.download,sourceIP:u.metadata.sourceIP,type:u.metadata.type,network:u.metadata.network.toUpperCase(),process:u.metadata.processPath,speed:{upload:u.uploadSpeed,download:u.downloadSpeed},completed:!!u.completed,original:u})),[h]),b=m.exports.useMemo(()=>{const u=nt(h,"metadata.sourceIP");return Object.keys(u).map(P=>({label:P,number:u[P].length})).sort((P,g)=>P.label.localeCompare(g.label))},[h]),S=m.exports.useRef(null),D=st(S,{threshold:[1]}),Y=m.exports.useMemo(()=>[$.accessor(v.Host,{minSize:260,size:260,header:s(`columns.${v.Host}`)}),$.accessor(v.Network,{minSize:80,size:80,header:s(`columns.${v.Network}`)}),$.accessor(v.Type,{minSize:100,size:100,header:s(`columns.${v.Type}`)}),$.accessor(v.Chains,{minSize:200,size:200,header:s(`columns.${v.Chains}`)}),$.accessor(v.Rule,{minSize:140,size:140,header:s(`columns.${v.Rule}`)}),$.accessor(v.Process,{minSize:100,size:100,header:s(`columns.${v.Process}`),cell:u=>u.getValue()?Ae(u.getValue()):"-"}),$.accessor(u=>[u.speed.upload,u.speed.download],{id:v.Speed,header:s(`columns.${v.Speed}`),minSize:200,size:200,sortDescFirst:!0,sortingFn(u,P){var z,K,Ce,Ne;const g=(K=(z=u.original)==null?void 0:z.speed)!=null?K:{upload:0,download:0},R=(Ne=(Ce=P.original)==null?void 0:Ce.speed)!=null?Ne:{upload:0,download:0};return g.download===R.download?g.upload-R.upload:g.download-R.download},cell:u=>en(u.getValue()[0],u.getValue()[1])}),$.accessor(v.Upload,{minSize:100,size:100,header:s(`columns.${v.Upload}`),cell:u=>L(u.getValue())}),$.accessor(v.Download,{minSize:100,size:100,header:s(`columns.${v.Download}`),cell:u=>L(u.getValue())}),$.accessor(v.SourceIP,{minSize:140,size:140,header:s(`columns.${v.SourceIP}`),filterFn:"equals"}),$.accessor(v.Time,{minSize:120,size:120,header:s(`columns.${v.Time}`),cell:u=>ve(new Date(u.getValue()),n),sortingFn:(u,P)=>{var g,R,z,K;return((R=(g=P.original)==null?void 0:g.time)!=null?R:0)-((K=(z=u.original)==null?void 0:z.time)!=null?K:0)}})],[n,s]);m.exports.useLayoutEffect(()=>{function u(P){for(const g of P)i({uploadTotal:g.uploadTotal,downloadTotal:g.downloadTotal}),p(g.connections)}return o==null||o.subscribe("data",u),()=>{o==null||o.unsubscribe("data",u)}},[o,p,i]),ot(()=>{var u;(u=a.current)==null||u.destory()});const j=at({data:N,columns:Y,getCoreRowModel:rt(),getSortedRowModel:ct(),getFilteredRowModel:it(),initialState:{sorting:[{id:v.Time,desc:!1}]},columnResizeMode:"onChange",enableColumnResizing:!0}),X=j.getHeaderGroups()[0],[W,_e]=m.exports.useState("");function Ge(u){_e(u),j.getColumn(v.SourceIP).setFilterValue(u||void 0)}const[M,_]=ie({visible:!1,selectedID:"",connection:{}});function Je(){_(u=>{u.connection.completed=!0}),l.closeConnection(M.selectedID)}const q=re(M.connection);m.exports.useEffect(()=>{var P;const u=(P=N.find(g=>g.id===M.selectedID))==null?void 0:P.original;u?_(g=>{g.connection={...u},M.selectedID===q.current.id&&(g.connection.completed=q.current.completed)}):Object.keys(q.current).length!==0&&!q.current.completed&&_(g=>{g.connection.completed=!0})},[N,M.selectedID,q,_]);const we=m.exports.useMemo(()=>{var u;return((u=D==null?void 0:D.intersectionRatio)!=null?u:0)<1},[D]),Xe=X.headers.map((u,P)=>{const g=u.column,R=g.id;return e.createElement("th",{className:w("connections-th",{resizing:g.getIsResizing(),fixed:g.id===v.Host,shadow:we&&g.id===v.Host}),style:{width:u.getSize()},ref:g.id===v.Host?S:void 0,key:R},e.createElement("div",{onClick:g.getToggleSortingHandler()},be(u.column.columnDef.header,u.getContext()),g.getIsSorted()!==!1?g.getIsSorted()==="desc"?" \u2193":" \u2191":null),P!==X.headers.length-1&&e.createElement("div",{onMouseDown:u.getResizeHandler(),onTouchStart:u.getResizeHandler(),className:"connections-resizer"}))}),qe=j.getRowModel().rows.map(u=>{var P;return e.createElement("tr",{className:"cursor-default select-none",key:(P=u.original)==null?void 0:P.id,onClick:()=>{var g;return _({visible:!0,selectedID:(g=u.original)==null?void 0:g.id})}},u.getAllCells().map(g=>{var z;const R=w("connections-block",{"text-center":Zt.has(g.column.id),completed:(z=u.original)==null?void 0:z.completed},{fixed:g.column.id===v.Host,shadow:we&&g.column.id===v.Host});return e.createElement("td",{className:R,style:{width:g.column.getSize()},key:g.column.id},be(g.column.columnDef.cell,g.getContext()))}))});return e.createElement("div",{className:"page !h-100vh"},e.createElement(O,{title:s("title")},e.createElement("span",{className:"connections-filter flex-1 cursor-default"},`(${s("total.text")}: ${s("total.upload")} ${L(c.uploadTotal)} ${s("total.download")} ${L(c.downloadTotal)})`),e.createElement(Ve,{className:"connections-filter",checked:y,onChange:C},s("keepClosed")),e.createElement(T,{className:"connections-filter dangerous",onClick:f,type:"close-all",size:20})),b.length>1&&e.createElement(qt,{devices:b,selected:W,onChange:Ge}),e.createElement(V,{ref:r,className:"connections-card relative"},e.createElement("div",{className:"min-h-full min-w-full overflow-auto"},e.createElement("table",null,e.createElement("thead",null,e.createElement("tr",{className:"connections-header"},Xe)),e.createElement("tbody",null,qe)))),e.createElement(Oe,{title:s("closeAll.title"),show:d,onClose:E,onOk:x},s("closeAll.content")),e.createElement(Xt,{containerRef:r,bodyClassName:"flex flex-col",visible:M.visible,width:450},e.createElement("div",{className:"flex h-8 items-center justify-between"},e.createElement("span",{className:"pl-3 font-bold"},s("info.title")),e.createElement(T,{type:"close",size:16,className:"cursor-pointer",onClick:()=>_("visible",!1)})),e.createElement(Kt,{className:"mt-3 px-5",connection:M.connection}),e.createElement("div",{className:"mt-3 flex justify-end pr-3"},e.createElement(ce,{type:"danger",disiabled:M.connection.completed,onClick:()=>Je()},s("info.closeConnection")))))}function nn(){const{translation:t}=k(),{t:n}=t("Settings"),{hostname:s,port:o,secret:a}=te(),[l,r]=I(Le),[c,i]=ie({hostname:"",port:"",secret:""});m.exports.useEffect(()=>{i({hostname:s,port:o,secret:a})},[s,o,a,i]);const d=De(Re);function f(){const{hostname:E,port:x,secret:h}=c;d([{hostname:E,port:x,secret:h}])}return e.createElement(Oe,{show:!l,title:n("externalControllerSetting.title"),bodyClassName:"external-controller",onClose:()=>r(!0),onOk:f},e.createElement(_t,{type:"info",inside:!0},e.createElement("p",null,n("externalControllerSetting.note"))),e.createElement("div",{className:"flex items-center"},e.createElement("span",{className:"my-1 w-14 font-bold md:my-3"},n("externalControllerSetting.host")),e.createElement(ae,{className:"my-1 flex-1 md:my-3",align:"left",inside:!0,value:c.hostname,onChange:E=>i("hostname",E),onEnter:f})),e.createElement("div",{className:"flex items-center"},e.createElement("div",{className:"my-1 w-14 font-bold md:my-3"},n("externalControllerSetting.port")),e.createElement(ae,{className:"my-1 w-14 flex-1 md:my-3",align:"left",inside:!0,value:c.port,onChange:E=>i("port",E),onEnter:f})),e.createElement("div",{className:"flex items-center"},e.createElement("div",{className:"my-1 w-14 font-bold md:my-3"},n("externalControllerSetting.secret")),e.createElement(ae,{className:"my-1 w-14 flex-1 md:my-3",align:"left",inside:!0,value:c.secret,onChange:E=>i("secret",E),onEnter:f})))}const sn=[{label:"Default",value:""},{label:"Debug",value:"debug"},{label:"Info",value:"info"},{label:"Warn",value:"warning"},{label:"Error",value:"error"},{label:"Silent",value:"silent"}],on=new Map([["debug","text-teal-500"],["info","text-sky-500"],["warning","text-pink-500"],["error","text-rose-500"]]);function an(){var x,h;const t=m.exports.useRef(null),n=m.exports.useRef([]),[s,o]=m.exports.useState([]),{translation:a}=k(),{data:{logLevel:l},set:r}=ne(),{general:{logLevel:c}}=ge(),{t:i}=a("Logs"),d=Ue(),f=m.exports.useRef((h=(x=t.current)==null?void 0:x.scrollHeight)!=null?h:0),E=ut(c)==="silent";return m.exports.useLayoutEffect(()=>{var y;const p=t.current;p!=null&&f.current===p.scrollTop+p.clientHeight&&(p.scrollTop=p.scrollHeight-p.clientHeight),f.current=(y=p==null?void 0:p.scrollHeight)!=null?y:0}),m.exports.useEffect(()=>{function p(y){n.current=n.current.slice().concat(y.map(C=>({...C,time:new Date}))),o(n.current)}return d!=null&&(d.subscribe("data",p),n.current=d.buffer(),o(n.current)),()=>d==null?void 0:d.unsubscribe("data",p)},[d]),e.createElement("div",{className:"page"},e.createElement(O,{title:i("title")},e.createElement("span",{className:"text-primary-darken mr-2 text-sm"},i("levelLabel"),":"),e.createElement(Vt,{disabled:E,options:sn,value:E?"silent":l,onSelect:p=>r(y=>{y.logLevel=p})})),e.createElement(V,{className:"mt-2.5 flex flex-1 flex-col md:mt-4"},e.createElement("ul",{className:"logs-panel",ref:t},s.map((p,y)=>e.createElement("li",{className:"inline-block text-[11px] leading-5",key:y},e.createElement("span",{className:"mr-2 text-orange-400"},"[",Q(p.time).format("YYYY-MM-DD HH:mm:ss"),"]"),e.createElement("span",{className:on.get(p.type)},"[",p.type.toUpperCase(),"]"),e.createElement("span",null," ",p.payload))))))}var ue=(t=>(t.SPEED_NOTIFY="speed-notify",t))(ue||{});class ln{constructor(){this.EE=new ke}notifySpeedTest(){this.EE.emit("speed-notify")}subscribe(n,s){this.EE.addListener(n,s)}unsubscribe(n,s){this.EE.removeListener(n,s)}}const me=new ln;const Pe={"#909399":0,"#00c520":260,"#ff9a28":600,"#ff3e5e":1/0};function We(t){var h,p;const{config:n,className:s}=t,{set:o}=se(),a=A(),l=m.exports.useCallback(async y=>{var N;if(J())return(N=await(F==null?void 0:F.getProxyDelay(y)))!=null?N:0;const{data:{delay:C}}=await a.getProxyDelay(y);return C},[a]),r=m.exports.useCallback(async function(){const y=await Fe.fromPromise(l(n.name),N=>N),C=y.isErr()?0:y.value;o(N=>{const b=N.proxies.find(S=>S.name===n.name);b!=null&&b.history.push({time:Date.now().toString(),delay:C})})},[n.name,l,o]),c=m.exports.useMemo(()=>{var y;return(y=n.history)!=null&&y.length?n.history.slice(-1)[0].delay:0},[n]);m.exports.useLayoutEffect(()=>{const y=()=>{r()};return me.subscribe(ue.SPEED_NOTIFY,y),()=>me.unsubscribe(ue.SPEED_NOTIFY,y)},[r]);const i=m.exports.useMemo(()=>c===0,[c]),d=m.exports.useMemo(()=>Object.keys(Pe).find(y=>c<=Pe[y]),[c]),f=i?"#E5E7EB":d;function E(){if(t.config.secretData==null){G.error("No data",{duration:500});return}navigator.clipboard.writeText(t.config.secretData).catch(()=>G("err",{duration:500})).then(()=>G("ok",{duration:500}))}const x=(p=(h=t.config)==null?void 0:h.all)!=null?p:[];return e.createElement("div",{className:w("proxy-item",{"opacity-50":i},s)},e.createElement("div",{className:"flex-1 "},e.createElement("div",{className:"flex items-center display:flex"},e.createElement("span",{className:w("rounded-sm py-[3px] px-1 text-[10px] text-white",{"text-gray-600":i}),style:{backgroundColor:f}},n.type),e.createElement("div",{className:"proxy-info-copy flex flex-auto items-center justify-end"},e.createElement("p",{className:"rounded-sm py-[3px] px-1 text-[10px]",style:{backgroundColor:"#E5E7EB"},onClick:E},"info"))),e.createElement("p",{className:"proxy-name"},n.name),x.map((y,C)=>e.createElement("div",{className:"relay-node"},"- ",y))),e.createElement("div",{className:"flex h-full flex-col items-center justify-center space-y-3 text-[10px] md:h-[18px] md:flex-row md:justify-between md:space-y-0"},e.createElement("p",null,c===0?"-":`${c}ms`),n.udp&&e.createElement("p",{className:"rounded bg-gray-200 p-[3px] text-gray-600"},"UDP")))}function rn(t){const{markProxySelected:n}=se(),[s]=I(Rt),{data:o}=ne(),a=A(),{config:l}=t;async function r(d){if(await a.changeProxySelected(t.config.name,d),n(t.config.name,d),o.breakConnections){const f=[],E=await a.getConnections();for(const x of E.data.connections)x.chains.includes(t.config.name)&&f.push(x.id);await Promise.all(f.map(x=>a.closeConnection(x)))}}const c=m.exports.useMemo(()=>{var f;const d=new Set;for(const E of l.all){const x=(f=s.get(E))==null?void 0:f.history;(x==null?void 0:x.length)&&x.slice(-1)[0].delay===0&&d.add(E)}return d},[l.all,s]),i=l.type==="Selector";return e.createElement("div",{className:"proxy-group"},e.createElement("div",{className:"md:h-15 mt-4 flex h-10 w-full items-center justify-between md:mt-0 md:w-auto"},e.createElement("span",{className:"w-35 md:w-30 h-6 overflow-hidden overflow-ellipsis whitespace-nowrap px-5"},l.name),e.createElement(Z,{className:"mr-5 md:mr-0"},l.type)),e.createElement("div",{className:"flex-1 py-2 md:py-4"},e.createElement(Ot,{className:"ml-5 md:ml-8",data:l.all,onClick:r,errSet:c,select:l.now,canClick:i,rowHeight:30})))}function cn(t){const{update:n}=ze(),{translation:s,lang:o}=k(),a=A(),{provider:l}=t,{t:r}=s("Proxies"),{visible:c,hide:i,show:d}=xe();function f(){d(),a.healthCheckProvider(l.name).then(async()=>await n()).finally(()=>i())}function E(){d(),a.updateProvider(l.name).then(async()=>await n()).finally(()=>i())}const x=m.exports.useMemo(()=>l.proxies.slice().sort((h,p)=>-1*de(h,p)),[l.proxies]);return e.createElement(V,{className:"proxy-provider"},e.createElement(je,{visible:c}),e.createElement("div",{className:"md:flex-row md:items-center flex flex-col justify-between"},e.createElement("div",{className:"flex items-center"},e.createElement("span",{className:"mr-6"},l.name),e.createElement(Z,null,l.vehicleType)),e.createElement("div",{className:"flex items-center pt-3 md:pt-0"},l.updatedAt&&e.createElement("span",{className:"text-sm"},`${r("providerUpdateTime")}: ${ve(new Date(l.updatedAt),o)}`),e.createElement(T,{className:"text-red cursor-pointer pl-5",type:"healthcheck",size:18,onClick:f}),e.createElement(T,{className:"cursor-pointer pl-5",type:"update",size:18,onClick:E}))),e.createElement("ul",{className:"proxies-list"},x.map(h=>e.createElement("li",{key:h.name},e.createElement(We,{className:"proxy-provider-item",config:h})))))}const un={[0]:"sort",[1]:"sort-ascending",[2]:"sort-descending"};function de(t,n){const s=t.history.length>0?t.history.slice(-1)[0].delay:0;return((n.history.length>0?n.history.slice(-1)[0].delay:0)||Number.MAX_SAFE_INTEGER)-(s||Number.MAX_SAFE_INTEGER)}function mn(){const{groups:t,global:n}=se(),{data:s,set:o}=ne(),{general:a}=ge(),{translation:l}=k(),{t:r}=l("Proxies"),c=m.exports.useMemo(()=>a.mode==="global"?[n,...t]:t,[a,t,n]);return e.createElement(e.Fragment,null,c.length!==0&&e.createElement("div",{className:"flex flex-col"},e.createElement(O,{title:r("groupTitle")},e.createElement(Ve,{className:"text-shadow-primary text-primary-600 cursor-pointer text-sm",checked:s.breakConnections,onChange:i=>o("breakConnections",i)},r("breakConnectionsText"))),e.createElement(V,{className:"my-2.5 p-0 md:my-4"},e.createElement("ul",{className:"list-none divide-y divide-gray-300"},c.map(i=>e.createElement("li",{key:i.name},e.createElement(rn,{config:i})))))))}function dn(){const{providers:t}=ze(),{translation:n}=k(),{t:s}=n("Proxies");return e.createElement(e.Fragment,null,t.length!==0&&e.createElement("div",{className:"flex flex-col"},e.createElement(O,{title:s("providerTitle")}),e.createElement("ul",{className:"list-none"},t.map(o=>e.createElement("li",{className:"my-2.5 md:my-4",key:o.name},e.createElement(cn,{provider:o}))))))}function pn(){const{proxies:t}=se(),{translation:n}=k(),{t:s}=n("Proxies");function o(){me.notifySpeedTest()}const{current:a,next:l}=Gt([1,2,0]),r=m.exports.useMemo(()=>{switch(a){case 2:return t.slice().sort((i,d)=>de(i,d));case 1:return t.slice().sort((i,d)=>-1*de(i,d));default:return t.slice()}},[a,t]),c=l;return e.createElement(e.Fragment,null,r.length!==0&&e.createElement("div",{className:"flex flex-col"},e.createElement(O,{title:s("title")},e.createElement(T,{className:"ml-3",type:un[a],onClick:c,size:20}),e.createElement(T,{className:"ml-3",type:"speed",size:20}),e.createElement("span",{className:"proxies-speed-test",onClick:o},s("speedTestText"))),e.createElement("ul",{className:"proxies-list"},r.map(i=>e.createElement("li",{key:i.name},e.createElement(We,{config:i}))))))}function fn(){return e.createElement("div",{className:"page"},e.createElement(mn,null),e.createElement(dn,null),e.createElement(pn,null))}function En(t){const{update:n}=Be(),{translation:s,lang:o}=k(),a=A(),{provider:l}=t,{t:r}=s("Rules"),{visible:c,hide:i,show:d}=xe();function f(){d(),a.updateRuleProvider(l.name).then(async()=>await n()).finally(()=>i())}const E=w("rule-provider-icon",{"rule-provider-loading":c});return e.createElement("div",{className:"rule-provider"},e.createElement("div",{className:"rule-provider-header"},e.createElement("div",{className:"rule-provider-header-part"},e.createElement("span",{className:"rule-provider-name"},l.name),e.createElement(Z,null,l.vehicleType),e.createElement(Z,{className:"rule-provider-behavior"},l.behavior),e.createElement("span",{className:"rule-provider-update"},`${r("ruleCount")}: ${l.ruleCount}`)),e.createElement("div",{className:"rule-provider-header-part"},l.updatedAt&&e.createElement("span",{className:"rule-provider-update"},`${r("providerUpdateTime")}: ${ve(new Date(l.updatedAt),o)}`),e.createElement(T,{className:E,type:"update",size:18,onClick:f}))))}function hn(){const{providers:t}=Be(),{translation:n}=k(),{t:s}=n("Rules");return e.createElement(e.Fragment,null,t.length!==0&&e.createElement("div",{className:"flex flex-col"},e.createElement(O,{title:s("providerTitle")}),e.createElement(V,{className:"shadow-primary mt-4 divide-y rounded p-0"},t.map(o=>e.createElement(En,{key:o.name,provider:o})))))}function yn(){const{rules:t,update:n}=Bt(),{translation:s}=k(),{t:o}=s("Rules");H("rules",n);function a({index:l,style:r}){const c=t[l];return e.createElement("li",{className:"rule-item",style:r},e.createElement("div",{className:"flex py-1"},e.createElement("div",{className:"rule-type w-40 text-center"},c.type),e.createElement("div",{className:"payload flex-1 text-center"},c.payload),e.createElement("div",{className:"rule-proxy w-40 text-center"},c.proxy)))}return e.createElement("div",{className:"page"},e.createElement(hn,null),e.createElement(O,{className:"not-first:mt-7.5",title:o("title")}),e.createElement(V,{className:"mt-2.5 flex flex-1 flex-col p-0 focus:outline-none md:mt-4"},e.createElement(mt,{className:"min-h-120"},({height:l,width:r})=>e.createElement(dt,{height:l,width:r,itemCount:t.length,itemSize:50},a))))}const gn=""+new URL("logo.b453e72f.png",import.meta.url).href;function xn(t){const{routes:n}=t,{translation:s}=k(),{version:o,premium:a}=$t(),{data:l}=Lt(),{t:r}=s("SideBar"),c=Ee(),i=n.map(({path:d,name:f,noMobile:E})=>e.createElement("li",{className:w("item",{"no-mobile":E}),key:f},e.createElement(pt,{to:{pathname:d,search:c.search},className:({isActive:x})=>w({active:x})},r(f))));return e.createElement("div",{className:"sidebar"},e.createElement("img",{src:gn,alt:"logo",className:"sidebar-logo"}),e.createElement("ul",{className:"sidebar-menu"},i),e.createElement("div",{className:"sidebar-version"},e.createElement("span",{className:"sidebar-version-label"},"Clash",(l==null?void 0:l.isClashX)&&"X"," ",r("Version")),e.createElement("span",{className:"sidebar-version-text"},o),a&&e.createElement("span",{className:"sidebar-version-label"},"Premium")))}function vn(t){const{config:n,className:s}=t,o="#00C520";function a(){if(t.config.secretData==null){G.error("No data",{duration:500});return}navigator.clipboard.writeText(t.config.secretData).catch(()=>G("err",{duration:500})).then(()=>G("ok",{duration:500}))}return e.createElement("div",{className:w("inbound-item",n.type)},e.createElement("div",{className:"flex-1 "},e.createElement("div",{className:"flex items-center display:flex"},e.createElement("span",{className:w("rounded-sm py-[3px] px-1 text-[10px] text-white"),style:{backgroundColor:o}},n.type),e.createElement("div",{className:"proxy-info-copy flex flex-auto items-center justify-end"},e.createElement("p",{className:"rounded-sm py-[3px] px-1 text-[10px]",style:{backgroundColor:"#E5E7EB"},onClick:a},"info"))),e.createElement("p",{className:"inbound-name"},n.name),e.createElement("p",{className:"inbound-addr"},n.rawAddress)))}function wn(){const{inbounds:t,update:n}=Ut();return H("inbounds",n),console.log(t),e.createElement("div",{className:"page"},t.length!==0&&e.createElement("div",{className:"flex flex-col"},e.createElement("ul",{className:"inbounds-list"},t.map(s=>e.createElement("li",null,e.createElement(vn,{config:s}))))))}function Cn(){Ue();const t=Ee(),n=[{path:"/proxies",name:"Proxies",element:e.createElement(fn,null)},{path:"/inbounds",name:"Inbounds",element:e.createElement(wn,null)},{path:"/logs",name:"Logs",element:e.createElement(an,null)},{path:"/rules",name:"Rules",element:e.createElement(yn,null),noMobile:!0},{path:"/connections",name:"Connections",element:e.createElement(tn,null),noMobile:!0}],s=e.createElement("div",{className:w("app",{"not-clashx":!J()})},e.createElement(ft,null),e.createElement(xn,{routes:n}),e.createElement("div",{className:"page-container"},e.createElement(Et,null)),e.createElement(nn,null));return e.createElement(ht,null,e.createElement(oe,{path:"/",element:s},e.createElement(oe,{path:"/",element:e.createElement(yt,{to:{pathname:"/proxies",search:t.search},replace:!0})}),n.map(o=>e.createElement(oe,{path:o.path,key:o.path,element:o.element}))))}function Se(){const t=document.getElementById("root"),n=e.createElement(m.exports.StrictMode,null,e.createElement(xt,null,e.createElement(m.exports.Suspense,{fallback:e.createElement(je,{visible:!0})},e.createElement(Cn,null))));gt(t).render(n)}J()?wt(()=>Se()):Se();
